{
    # Mantemos o staging enquanto o bloqueio da Let's Encrypt durar
    acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

optafund.com {
    # 1. Bloco da API
    handle /api/* {
        uri strip_prefix /api
        reverse_proxy api-server:8081
    }

    # ðŸ”¥ 2. NOVO BLOCO: AI Optimizer
    # Enviamos para o contentor 'ai-optimizer' na porta 3003
    handle /optimizer/* {
        reverse_proxy ai-optimizer:3003
    }

    # 3. Bloco de WebSockets
    handle /ws {
        uri strip_prefix /ws
        reverse_proxy api-server:8081
    }

    # 4. Frontend
    handle {
        root * /usr/share/caddy
        try_files {path} /index.html
        file_server
    }
}