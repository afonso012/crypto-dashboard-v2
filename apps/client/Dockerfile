# Etapa 1: Construir (Build)
FROM node:20-alpine as builder
WORKDIR /app

# Copia tudo da raiz
COPY . .

# Instala dependÃªncias
RUN npm install -g pnpm && pnpm install

# ConstrÃ³i apenas o cliente
RUN pnpm --filter client build

# Etapa 2: Servir com Caddy
FROM caddy:2-alpine

# << ðŸ”¥ A CORREÃ‡ÃƒO ESTÃ AQUI ðŸ”¥ >>
# O caminho correto depois do build Ã©: /app/apps/client/dist
COPY --from=builder /app/apps/client/dist /usr/share/caddy

# Copia o Caddyfile da pasta correta
COPY --from=builder /app/apps/client/Caddyfile /etc/caddy/Caddyfile

EXPOSE 80
EXPOSE 443